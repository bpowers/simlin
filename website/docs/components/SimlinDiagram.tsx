import React from 'react';
import { toUint8Array } from 'js-base64';
import { Map, Set } from 'immutable';
import { defined, Series } from '@simlin/core/common';
import { UID, ViewElement, Project } from '@simlin/core/datamodel';
import { Point } from '@simlin/diagram/drawing/common';
import { Canvas } from '@simlin/diagram/drawing/Canvas';

const logisticGrowthProject = 'Cg9sb2dpc3RpYy1ncm93dGgSFBEAAAAAAABZQBoJCQAAAAAAAPA/GrYGCgRtYWluGiUKIwoKcG9wdWxhdGlvbioObmV0X2JpcnRoX3JhdGVCBQoDCgE1GjsSOQoObmV0X2JpcnRoX3JhdGVCJwolCiNmcmFjdGlvbmFsX2dyb3d0aF9yYXRlICogcG9wdWxhdGlvbhogGh4KE21heGltdW1fZ3Jvd3RoX3JhdGUyBwoFCgMuMTIaHxodChFjYXJyeWluZ19jYXBhY2l0eTIICgYKBDEwMDAaXhpcChZmcmFjdGlvbmFsX2dyb3d0aF9yYXRlMkIKQAo+bWF4aW11bV9ncm93dGhfcmF0ZSAqICgxIC0gZnJhY3Rpb25fb2ZfY2FycnlpbmdfY2FwYWNpdHlfdXNlZCkaSBpGCiJmcmFjdGlvbl9vZl9jYXJyeWluZ19jYXBhY2l0eV91c2VkMiAKHgoccG9wdWxhdGlvbi9jYXJyeWluZ19jYXBhY2l0eSLcAxoiEiAKClBvcHVsYXRpb24QARkAAABAM9OCQCEAAADgzDxwQBpSGlAKDm5ldCBiaXJ0aCByYXRlEAIZqvbqaC4ygEAhAAAAwJkpcEAyFAkAAADAzIx8QBEAAADAmSlwQBgNMhQJAAAAQDMfgkARAAAAwJkpcEAYARotCisKE21heGltdW0KZ3Jvd3RoIHJhdGUQAxnNzMxMM/N8QCEAAABACgd5QCgBGisKKQoRY2FycnlpbmcgY2FwYWNpdHkQBBmZmZlZuF6EQCFnZmbm1vN4QCgEGjEKLwoXZnJhY3Rpb25hbCAKZ3Jvd3RoIHJhdGUQBRkAAAAAACB/QCEAAABAM4N1QCgBGjwKOgoiZnJhY3Rpb24gb2YgY2FycnlpbmcKY2FwYWNpdHkgdXNlZBAGGQAAAIBmFoNAIQAAAKCZiXVAKAQaESIPCAcQBBgGIWZANqZnymxAGhEiDwgIEAEYBiEgMB5yvNFIQBoRIg8ICRAGGAUhjENNVBh1YEAaESIPCAoQAxgFIbDL4YNiz3JAGhEiDwgLEAUYAiHS1VhKsiVuQBoRIg8IDBABGAIh4KA0JrmkWUAaGDoWCA0QAhkAAADAzIx8QCEAAADAmSlwQCIAKQAAAAAAAPA/';

const logisticGrowthData = Map<string, Series>([
  ["time", { name: "time", time: (new Float64Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])) as Readonly<Float64Array>, values: (new Float64Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])) as Readonly<Float64Array> } as const ] as const,
  ["carrying_capacity", { name: "carrying_capacity", time: (new Float64Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])) as Readonly<Float64Array>, values: (new Float64Array([1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000])) as Readonly<Float64Array> } as const ] as const,
  ["fraction_of_carrying_capacity_used", { name: "fraction_of_carrying_capacity_used", time: (new Float64Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])) as Readonly<Float64Array>, values: (new Float64Array([0.005,0.0055969999999999995,0.006264880830919999,0.007011956682811324,0.007847491380366087,0.008781800371494227,0.009826362013941761,0.010993938568763286,0.012298707194784432,0.013756401074318999,0.015384460574775176,0.01720219404848698,0.0192309474766956,0.021494281652996904,0.02401815495410313,0.026831108936507586,0.029964453000076968,0.03345244314685494,0.03733244841017831,0.041645096814883875,0.04643439074202342,0.05174777931383628,0.05763617291182701,0.0641538822498956,0.07135846164695506,0.07931043343875528,0.08807286806913674,0.09771079262664231,0.10829039986235219,0.11987803056155268,0.132538905163581,0.14633558641737546,0.16132616432520644,0.1775621682887252,0.195086229650485,0.21392954076863419,0.23410918385125284,0.25562543271778326,0.27845916122165876,0.30256952003206544,0.3278920647016212,0.35433752773450067,0.381791421035321,0.4101146288584191,0.43914510326498796,0.46870070505019246,0.4985831475464699,0.5285829066499649,0.5584848687436577,0.5880744111590221,0.6171435589309011,0.6454968453230214,0.6729565254831472,0.6993668503182829,0.724597193397583,0.7485439254837344,0.7711310355363507,0.7923095909246289,0.8120562032910461,0.8303707144095553,0.8472733373368178,0.8628014848378117,0.8770064947497492,0.88995042709973,0.9017030668282987,0.9123392243603875,0.9219363880468524,0.9305727501798895,0.9383256029961926,0.9452700828871555,0.9514782292814354,0.9570183182996234,0.9619544291082536,0.9663462017595256,0.9702487481720613,0.9737126819531744,0.976784237347982,0.9795054522699624,0.9819143948191679,0.984045416747097,0.9859294208902325,0.9875941326398264,0.9890643680576523,0.9903622933252165,0.9915076718793966,0.9925180968974401,0.993409207804863,0.9941948902432682,0.9948874594981616,0.9954978277899362,0.9960356561085907,0.996509491452861,0.9969268904405276,0.9972945303073806,0.997618308322544,0.997903430629209,0.9981544914813288,0.9983755437953663,0.998570161876967,0.9987414971192841,0.9988923274054299])) as Readonly<Float64Array> } as const ] as const,
  ["fractional_growth_rate", { name: "fractional_growth_rate", time: (new Float64Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])) as Readonly<Float64Array>, values: (new Float64Array([0.11939999999999999,0.11932836,0.11924821430028959,0.11915856519806264,0.11905830103435606,0.11894618395542068,0.118820836558327,0.1186807273717484,0.11852415513662587,0.11834923187108172,0.11815386473102697,0.11793573671418156,0.11769228630279652,0.11742068620164037,0.11711782140550762,0.11678026692761907,0.11640426563999076,0.11598570682237741,0.1155201061907786,0.11500258838221394,0.11442787311095719,0.11379026648233964,0.11308365925058075,0.11230153413001252,0.1114369846023654,0.11048274798734936,0.10943125583170359,0.10827470488480292,0.10700515201651772,0.10561463633261367,0.10409533138037028,0.10243972962991495,0.10064086028097523,0.09869253980535297,0.0965896524419418,0.0943284551077639,0.09190689793784966,0.08932494807386601,0.08658490065340095,0.08369165759615213,0.08065295223580544,0.07747949667185992,0.07418502947576147,0.0707862445369897,0.06730258760820143,0.0637559153939769,0.06017002229442361,0.056570051202004215,0.05298181575076108,0.04943107066091734,0.04594277292829187,0.04254037856123743,0.039245216942022335,0.03607597796180605,0.03304833679229004,0.030174728941951872,0.027464275735637922,0.024922849089044526,0.022553255605074467,0.02035551427085336,0.01832719951958187,0.016463821819462595,0.014759220630030092,0.013205948748032393,0.011795631980604154,0.0105192930767535,0.009367633434377711,0.00833126997841326,0.007400927640456887,0.006567590053541336,0.005822612486227747,0.005157801804045197,0.004565468507009571,0.004038455788856932,0.0035701502193526435,0.0031544781656190723,0.002785891518242156,0.002459345727604507,0.0021702726216998557,0.0019145499903483597,0.0016884694931721,0.0014887040832208286,0.0013122758330817242,0.0011565248009740169,0.001019079374472409,0.00089782837230719,0.0007908950634164435,0.0006966131708078116,0.0006135048602206084,0.0005402606652076525,0.00047572126696911795,0.0004188610256566738,0.0003687731471366851,0.00032465636311433064,0.0002858030012947266,0.00025158832449491354,0.00022146102224053886,0.0001949347445560434,0.0001715805747639587,0.0001510203456859127,0.0001329207113484143])) as Readonly<Float64Array> } as const ] as const,
  ["maximum_growth_rate", { name: "maximum_growth_rate", time: (new Float64Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])) as Readonly<Float64Array>, values: (new Float64Array([0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12])) as Readonly<Float64Array> } as const ] as const,
  ["net_birth_rate", { name: "net_birth_rate", time: (new Float64Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])) as Readonly<Float64Array>, values: (new Float64Array([0.597,0.66788083092,0.7470758518913244,0.8355346975547642,0.93430899112814,1.0445616424475341,1.167576554821527,1.3047686260211455,1.4576938795345669,1.6280595004561769,1.8177334737118036,2.0287534282086215,2.263334176301301,2.5238733011062253,2.8129539824044585,3.1333440635693814,3.4879901467779777,3.8800052633233664,4.312648404705563,4.78929392713954,5.313388571812861,5.888393597990732,6.517709338068598,7.204579397059455,7.951971791800213,8.762434630381446,9.63792455750558,10.579607235709874,11.587630699200487,12.660874602028333,13.796681253794434,14.990577907830996,16.23600396351875,17.524061361759795,18.843311118149188,20.179643082618657,21.51624886653038,22.833728503875516,24.11035881040668,25.322544669555715,26.44546303287948,27.45389330082032,28.323207823098144,29.03047440656883,29.555601785204516,29.882442496277395,29.999759103494988,29.90196209369273,29.589542415364456,29.06914777187898,28.3532863921203,27.45968016012585,26.410324835135693,25.23034307930008,23.94673208615144,22.587110052616303,21.178555388278337,19.746612366417132,18.314511118509277,16.902622927262403,15.528147500993855,14.20500991193749,12.943932349980876,11.752639728568575,10.636157532088726,9.597163686464881,8.636362133037117,7.752852816303176,6.9444798909628975,6.208146394279877,5.540089018187953,4.936110808630098,4.3917726512721025,3.902546412535665,3.4639337811131123,3.071555394807677,2.7212149219803763,2.4089425492054524,2.1310219279290226,1.8840041431355021,1.6647117495939927,1.470235417825842,1.2979252675643047,1.145378554180117,1.0104250180434502,0.8911109074228585,0.785682438405306,0.6925692548932872,0.6103682917746558,0.537828318654564,0.4738353442703954,0.4173989876665558,0.3676398668529426,0.32377801516340876,0.285122306665151,0.2510608521197289,0.22105231403744033,0.19461808160075067,0.1713352423169893,0.15083028614582028,0.1327734787192029])) as Readonly<Float64Array> } as const ] as const,
  ["population", { name: "population", time: (new Float64Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100])) as Readonly<Float64Array>, values: (new Float64Array([5,5.5969999999999995,6.264880830919999,7.011956682811324,7.847491380366088,8.781800371494228,9.826362013941761,10.993938568763287,12.298707194784432,13.756401074319,15.384460574775176,17.20219404848698,19.2309474766956,21.494281652996904,24.018154954103128,26.831108936507587,29.96445300007697,33.45244314685495,37.332448410178316,41.64509681488388,46.43439074202342,51.747779313836276,57.63617291182701,64.1538822498956,71.35846164695506,79.31043343875528,88.07286806913673,97.71079262664232,108.29039986235219,119.87803056155268,132.538905163581,146.33558641737545,161.32616432520643,177.5621682887252,195.086229650485,213.92954076863418,234.10918385125285,255.62543271778324,278.45916122165875,302.56952003206544,327.89206470162117,354.33752773450067,381.791421035321,410.1146288584191,439.14510326498794,468.7007050501925,498.5831475464699,528.5829066499649,558.4848687436577,588.0744111590221,617.1435589309011,645.4968453230214,672.9565254831472,699.3668503182829,724.5971933975829,748.5439254837344,771.1310355363506,792.309590924629,812.0562032910461,830.3707144095554,847.2733373368178,862.8014848378117,877.0064947497492,889.9504270997301,901.7030668282987,912.3392243603874,921.9363880468524,930.5727501798895,938.3256029961926,945.2700828871556,951.4782292814355,957.0183182996234,961.9544291082535,966.3462017595256,970.2487481720613,973.7126819531744,976.7842373479821,979.5054522699625,981.9143948191679,984.045416747097,985.9294208902324,987.5941326398264,989.0643680576522,990.3622933252166,991.5076718793966,992.51809689744,993.409207804863,994.1948902432682,994.8874594981615,995.4978277899362,996.0356561085907,996.5094914528611,996.9268904405276,997.2945303073806,997.618308322544,997.9034306292091,998.1544914813288,998.3755437953663,998.5701618769671,998.7414971192841,998.8923274054299])) as Readonly<Float64Array> } as const ] as const,
] as Array<[string, Series]>);

interface DiagramState {
  project: Project;
}

export default class SimlinDiagram extends React.PureComponent<{}, DiagramState> {
  constructor(props: {}) {
    super(props);

    const serializedProject = toUint8Array(logisticGrowthProject);
    const project = Project.deserializeBinary(serializedProject).attachData(logisticGrowthData, 'main');

    this.state = {
      project,
    }
  }

  render() {
    const model = defined(this.state.project.models.get('main'));

    const renameVariable = (_oldName: string, _newName: string): void => {
    };
    const onSelection = (_selected: Set<UID>): void => {
    };
    const moveSelection = (_position: Point): void => {
    };
    const moveFlow = (_element: ViewElement, _target: number, _position: Point): void => {
    };
    const moveLabel = (_uid: UID, _side: 'top' | 'left' | 'bottom' | 'right'): void => {
    };
    const attachLink = (_element: ViewElement, _to: string): void => {
    };
    const createCb = (_element: ViewElement): void => {
    };
    const nullCb = (): void => {
    };

    const canvasElement = (
      <Canvas
        embedded={true}
        project={this.state.project}
        model={model}
        view={defined(model.views.get(0))}
        version={1}
        selectedTool={undefined}
        selection={Set()}
        onRenameVariable={renameVariable}
        onSetSelection={onSelection}
        onMoveSelection={moveSelection}
        onMoveFlow={moveFlow}
        onMoveLabel={moveLabel}
        onAttachLink={attachLink}
        onCreateVariable={createCb}
        onClearSelectedTool={nullCb}
        onDeleteSelection={nullCb}
        onShowVariableDetails={nullCb}
        onViewBoxChange={nullCb}
      />
    );

    return (
      <div style={{ height: '400px', width: '100%', border: '1px solid #e0e0e0', borderRadius: '8px', overflow: 'hidden' }}>
        {canvasElement}
      </div>
    );
  }
}