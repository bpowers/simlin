{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Project",
  "type": "object",
  "properties": {
    "name": {
      "type": "string"
    },
    "simSpecs": {
      "$ref": "#/$defs/SimSpecs"
    },
    "models": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Model"
      }
    },
    "dimensions": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Dimension"
      }
    },
    "units": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Unit"
      }
    },
    "source": {
      "anyOf": [
        {
          "$ref": "#/$defs/Source"
        },
        {
          "type": "null"
        }
      ]
    }
  },
  "required": [
    "name",
    "simSpecs",
    "models"
  ],
  "$defs": {
    "SimSpecs": {
      "type": "object",
      "properties": {
        "startTime": {
          "type": "number",
          "format": "double"
        },
        "endTime": {
          "type": "number",
          "format": "double"
        },
        "dt": {
          "type": "string"
        },
        "saveStep": {
          "type": "number",
          "format": "double"
        },
        "method": {
          "type": "string"
        },
        "timeUnits": {
          "type": "string"
        }
      },
      "required": [
        "startTime",
        "endTime"
      ]
    },
    "Model": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "stocks": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Stock"
          }
        },
        "flows": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Flow"
          }
        },
        "auxiliaries": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Auxiliary"
          }
        },
        "modules": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Module"
          }
        },
        "simSpecs": {
          "anyOf": [
            {
              "$ref": "#/$defs/SimSpecs"
            },
            {
              "type": "null"
            }
          ]
        },
        "views": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/View"
          }
        },
        "loopMetadata": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/LoopMetadata"
          }
        },
        "groups": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/ModelGroup"
          }
        }
      },
      "required": [
        "name"
      ]
    },
    "Stock": {
      "type": "object",
      "properties": {
        "uid": {
          "type": "integer",
          "format": "int32"
        },
        "name": {
          "type": "string"
        },
        "initialEquation": {
          "type": "string"
        },
        "units": {
          "type": "string"
        },
        "inflows": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "outflows": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "nonNegative": {
          "type": "boolean"
        },
        "documentation": {
          "type": "string"
        },
        "canBeModuleInput": {
          "type": "boolean"
        },
        "isPublic": {
          "type": "boolean"
        },
        "arrayedEquation": {
          "anyOf": [
            {
              "$ref": "#/$defs/ArrayedEquation"
            },
            {
              "type": "null"
            }
          ]
        },
        "compat": {
          "anyOf": [
            {
              "$ref": "#/$defs/Compat"
            },
            {
              "type": "null"
            }
          ]
        }
      },
      "required": [
        "name",
        "inflows",
        "outflows"
      ]
    },
    "ArrayedEquation": {
      "type": "object",
      "properties": {
        "dimensions": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "equation": {
          "type": [
            "string",
            "null"
          ]
        },
        "compat": {
          "anyOf": [
            {
              "$ref": "#/$defs/Compat"
            },
            {
              "type": "null"
            }
          ]
        },
        "elements": {
          "type": [
            "array",
            "null"
          ],
          "items": {
            "$ref": "#/$defs/ElementEquation"
          }
        }
      },
      "required": [
        "dimensions"
      ]
    },
    "Compat": {
      "type": "object",
      "properties": {
        "activeInitial": {
          "type": [
            "string",
            "null"
          ]
        }
      }
    },
    "ElementEquation": {
      "type": "object",
      "properties": {
        "subscript": {
          "type": "string"
        },
        "equation": {
          "type": "string"
        },
        "activeInitial": {
          "type": [
            "string",
            "null"
          ]
        },
        "graphicalFunction": {
          "anyOf": [
            {
              "$ref": "#/$defs/GraphicalFunction"
            },
            {
              "type": "null"
            }
          ]
        }
      },
      "required": [
        "subscript",
        "equation"
      ]
    },
    "GraphicalFunction": {
      "type": "object",
      "properties": {
        "points": {
          "type": "array",
          "items": {
            "type": "array",
            "items": {
              "type": "number",
              "format": "double"
            },
            "minItems": 2,
            "maxItems": 2
          }
        },
        "yPoints": {
          "type": "array",
          "items": {
            "type": "number",
            "format": "double"
          }
        },
        "kind": {
          "type": "string"
        },
        "xScale": {
          "anyOf": [
            {
              "$ref": "#/$defs/GraphicalFunctionScale"
            },
            {
              "type": "null"
            }
          ]
        },
        "yScale": {
          "anyOf": [
            {
              "$ref": "#/$defs/GraphicalFunctionScale"
            },
            {
              "type": "null"
            }
          ]
        }
      }
    },
    "GraphicalFunctionScale": {
      "type": "object",
      "properties": {
        "min": {
          "type": "number",
          "format": "double"
        },
        "max": {
          "type": "number",
          "format": "double"
        }
      },
      "required": [
        "min",
        "max"
      ]
    },
    "Flow": {
      "type": "object",
      "properties": {
        "uid": {
          "type": "integer",
          "format": "int32"
        },
        "name": {
          "type": "string"
        },
        "equation": {
          "type": "string"
        },
        "units": {
          "type": "string"
        },
        "nonNegative": {
          "type": "boolean"
        },
        "graphicalFunction": {
          "anyOf": [
            {
              "$ref": "#/$defs/GraphicalFunction"
            },
            {
              "type": "null"
            }
          ]
        },
        "documentation": {
          "type": "string"
        },
        "canBeModuleInput": {
          "type": "boolean"
        },
        "isPublic": {
          "type": "boolean"
        },
        "arrayedEquation": {
          "anyOf": [
            {
              "$ref": "#/$defs/ArrayedEquation"
            },
            {
              "type": "null"
            }
          ]
        },
        "compat": {
          "anyOf": [
            {
              "$ref": "#/$defs/Compat"
            },
            {
              "type": "null"
            }
          ]
        }
      },
      "required": [
        "name"
      ]
    },
    "Auxiliary": {
      "type": "object",
      "properties": {
        "uid": {
          "type": "integer",
          "format": "int32"
        },
        "name": {
          "type": "string"
        },
        "equation": {
          "type": "string"
        },
        "units": {
          "type": "string"
        },
        "graphicalFunction": {
          "anyOf": [
            {
              "$ref": "#/$defs/GraphicalFunction"
            },
            {
              "type": "null"
            }
          ]
        },
        "documentation": {
          "type": "string"
        },
        "canBeModuleInput": {
          "type": "boolean"
        },
        "isPublic": {
          "type": "boolean"
        },
        "arrayedEquation": {
          "anyOf": [
            {
              "$ref": "#/$defs/ArrayedEquation"
            },
            {
              "type": "null"
            }
          ]
        },
        "compat": {
          "anyOf": [
            {
              "$ref": "#/$defs/Compat"
            },
            {
              "type": "null"
            }
          ]
        }
      },
      "required": [
        "name"
      ]
    },
    "Module": {
      "type": "object",
      "properties": {
        "uid": {
          "type": "integer",
          "format": "int32"
        },
        "name": {
          "type": "string"
        },
        "modelName": {
          "type": "string"
        },
        "units": {
          "type": "string"
        },
        "documentation": {
          "type": "string"
        },
        "references": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/ModuleReference"
          }
        },
        "canBeModuleInput": {
          "type": "boolean"
        },
        "isPublic": {
          "type": "boolean"
        }
      },
      "required": [
        "name",
        "modelName"
      ]
    },
    "ModuleReference": {
      "type": "object",
      "properties": {
        "src": {
          "type": "string"
        },
        "dst": {
          "type": "string"
        }
      },
      "required": [
        "src",
        "dst"
      ]
    },
    "View": {
      "type": "object",
      "properties": {
        "kind": {
          "type": "string"
        },
        "elements": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/ViewElement"
          }
        },
        "viewBox": {
          "anyOf": [
            {
              "$ref": "#/$defs/Rect"
            },
            {
              "type": "null"
            }
          ]
        },
        "zoom": {
          "type": "number",
          "format": "double"
        },
        "useLetteredPolarity": {
          "type": "boolean"
        }
      },
      "required": [
        "elements"
      ]
    },
    "ViewElement": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "const": "stock"
            }
          },
          "$ref": "#/$defs/StockViewElement",
          "required": [
            "type"
          ]
        },
        {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "const": "flow"
            }
          },
          "$ref": "#/$defs/FlowViewElement",
          "required": [
            "type"
          ]
        },
        {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "const": "aux"
            }
          },
          "$ref": "#/$defs/AuxiliaryViewElement",
          "required": [
            "type"
          ]
        },
        {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "const": "cloud"
            }
          },
          "$ref": "#/$defs/CloudViewElement",
          "required": [
            "type"
          ]
        },
        {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "const": "link"
            }
          },
          "$ref": "#/$defs/LinkViewElement",
          "required": [
            "type"
          ]
        },
        {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "const": "module"
            }
          },
          "$ref": "#/$defs/ModuleViewElement",
          "required": [
            "type"
          ]
        },
        {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "const": "alias"
            }
          },
          "$ref": "#/$defs/AliasViewElement",
          "required": [
            "type"
          ]
        },
        {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "const": "group"
            }
          },
          "$ref": "#/$defs/GroupViewElement",
          "required": [
            "type"
          ]
        }
      ]
    },
    "StockViewElement": {
      "type": "object",
      "properties": {
        "uid": {
          "type": "integer",
          "format": "int32"
        },
        "name": {
          "type": "string"
        },
        "x": {
          "type": "number",
          "format": "double"
        },
        "y": {
          "type": "number",
          "format": "double"
        },
        "labelSide": {
          "type": "string"
        }
      },
      "required": [
        "uid",
        "name",
        "x",
        "y"
      ]
    },
    "FlowPoint": {
      "type": "object",
      "properties": {
        "x": {
          "type": "number",
          "format": "double"
        },
        "y": {
          "type": "number",
          "format": "double"
        },
        "attachedToUid": {
          "type": "integer",
          "format": "int32"
        }
      },
      "required": [
        "x",
        "y"
      ]
    },
    "FlowViewElement": {
      "type": "object",
      "properties": {
        "uid": {
          "type": "integer",
          "format": "int32"
        },
        "name": {
          "type": "string"
        },
        "x": {
          "type": "number",
          "format": "double"
        },
        "y": {
          "type": "number",
          "format": "double"
        },
        "labelSide": {
          "type": "string"
        },
        "points": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/FlowPoint"
          }
        }
      },
      "required": [
        "uid",
        "name",
        "x",
        "y",
        "points"
      ]
    },
    "AuxiliaryViewElement": {
      "type": "object",
      "properties": {
        "uid": {
          "type": "integer",
          "format": "int32"
        },
        "name": {
          "type": "string"
        },
        "x": {
          "type": "number",
          "format": "double"
        },
        "y": {
          "type": "number",
          "format": "double"
        },
        "labelSide": {
          "type": "string"
        }
      },
      "required": [
        "uid",
        "name",
        "x",
        "y"
      ]
    },
    "CloudViewElement": {
      "type": "object",
      "properties": {
        "uid": {
          "type": "integer",
          "format": "int32"
        },
        "flowUid": {
          "type": "integer",
          "format": "int32"
        },
        "x": {
          "type": "number",
          "format": "double"
        },
        "y": {
          "type": "number",
          "format": "double"
        }
      },
      "required": [
        "uid",
        "flowUid",
        "x",
        "y"
      ]
    },
    "LinkPoint": {
      "type": "object",
      "properties": {
        "x": {
          "type": "number",
          "format": "double"
        },
        "y": {
          "type": "number",
          "format": "double"
        }
      },
      "required": [
        "x",
        "y"
      ]
    },
    "LinkViewElement": {
      "type": "object",
      "properties": {
        "uid": {
          "type": "integer",
          "format": "int32"
        },
        "fromUid": {
          "type": "integer",
          "format": "int32"
        },
        "toUid": {
          "type": "integer",
          "format": "int32"
        },
        "arc": {
          "type": [
            "number",
            "null"
          ],
          "format": "double"
        },
        "multiPoints": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/LinkPoint"
          }
        },
        "polarity": {
          "type": [
            "string",
            "null"
          ]
        }
      },
      "required": [
        "uid",
        "fromUid",
        "toUid"
      ]
    },
    "ModuleViewElement": {
      "type": "object",
      "properties": {
        "uid": {
          "type": "integer",
          "format": "int32"
        },
        "name": {
          "type": "string"
        },
        "x": {
          "type": "number",
          "format": "double"
        },
        "y": {
          "type": "number",
          "format": "double"
        },
        "labelSide": {
          "type": "string"
        }
      },
      "required": [
        "uid",
        "name",
        "x",
        "y"
      ]
    },
    "AliasViewElement": {
      "type": "object",
      "properties": {
        "uid": {
          "type": "integer",
          "format": "int32"
        },
        "aliasOfUid": {
          "type": "integer",
          "format": "int32"
        },
        "x": {
          "type": "number",
          "format": "double"
        },
        "y": {
          "type": "number",
          "format": "double"
        },
        "labelSide": {
          "type": "string"
        }
      },
      "required": [
        "uid",
        "aliasOfUid",
        "x",
        "y"
      ]
    },
    "GroupViewElement": {
      "description": "Visual container for grouping related model elements.\nIn JSON (matching XMILE spec), x/y are top-left coordinates.",
      "type": "object",
      "properties": {
        "uid": {
          "type": "integer",
          "format": "int32"
        },
        "name": {
          "type": "string"
        },
        "x": {
          "type": "number",
          "format": "double"
        },
        "y": {
          "type": "number",
          "format": "double"
        },
        "width": {
          "type": "number",
          "format": "double"
        },
        "height": {
          "type": "number",
          "format": "double"
        }
      },
      "required": [
        "uid",
        "name",
        "x",
        "y",
        "width",
        "height"
      ]
    },
    "Rect": {
      "type": "object",
      "properties": {
        "x": {
          "type": "number",
          "format": "double"
        },
        "y": {
          "type": "number",
          "format": "double"
        },
        "width": {
          "type": "number",
          "format": "double"
        },
        "height": {
          "type": "number",
          "format": "double"
        }
      },
      "required": [
        "x",
        "y",
        "width",
        "height"
      ]
    },
    "LoopMetadata": {
      "type": "object",
      "properties": {
        "uids": {
          "type": "array",
          "items": {
            "type": "integer",
            "format": "int32"
          }
        },
        "deleted": {
          "type": "boolean"
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        }
      },
      "required": [
        "uids",
        "name"
      ]
    },
    "ModelGroup": {
      "description": "Semantic/organizational group for categorizing model variables.\nThis is distinct from visual diagram groups (ViewElement::Group).",
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "doc": {
          "type": [
            "string",
            "null"
          ]
        },
        "parent": {
          "type": [
            "string",
            "null"
          ]
        },
        "members": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "runEnabled": {
          "type": "boolean"
        }
      },
      "required": [
        "name"
      ]
    },
    "Dimension": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "elements": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "size": {
          "type": "integer",
          "format": "int32"
        },
        "mapsTo": {
          "description": "Optional dimension mapping target (e.g., DimA: A1, A2, A3 -> DimB).\nThis establishes a positional correspondence between this dimension's\nelements and the target dimension's elements.",
          "type": [
            "string",
            "null"
          ]
        }
      },
      "required": [
        "name"
      ]
    },
    "Unit": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "equation": {
          "type": "string"
        },
        "disabled": {
          "type": "boolean"
        },
        "aliases": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "name"
      ]
    },
    "Source": {
      "type": "object",
      "properties": {
        "extension": {
          "type": "string"
        },
        "content": {
          "type": "string"
        }
      }
    }
  }
}